# AnnoTRAITions

AnnoTRAITions brings the flexibility of [PHP 5.4's Traits](http://php.net/traits) to Java by way of an annotation and an associated processor.

## Introduction
---

Lovingly borrowed from the PHP documentation on the subject, "Traits are a mechanism for code reuse in single inheritance".

In practice, I've found Traits most usefull as a way to add functionality to an existing Class, without interrupting the logical flow of a hierarchy.

By way of an example, say you have a few classes;

	public class Apple {
		...
	}
	
	public class Orange {
		...
	}

One that posts a representation of an Object onto Twitter;

	public class Tweetable {
		public void postToTwitter() {
			...
		}
	}
	
And another one that posts a representation of an Object onto Facebook;

	public class Facebookable {
		public void postToFacebook() {
			...
		}
	}
	
Now, if you wanted `Apple` and `Orange` to both benifit from all the hard work you put in to write the `postToTwitter` and `postToFacebook` methods, you'd need to have them both extend some Class that implements both snippets.

But, what if `Apple` and `Orange` already extend some other Class? You could possibily mess with your hierarchy and introduce a common ancestor at some level, but what you really want is a way to inject the `postToTwitter` and `postToFacebook` methods into both Classes. 

What you want is to say that `Apple` and `Orange` use the Traits `Tweetable` and `Facebookable`.

## Installing
---

1. Add AnnoTRAITions to your project.
	* Add the repository to your `build.gradle` file;

			repositories {
    			maven {
        			url 'https://raw.github.com/iainconnor/annoTRAITion/master/maven/'
    			}
			}
	
	* And add the dependency;
	
			dependencies {
  	  			compile 'com.iainconnor:annotraitions:1.0.0'
			}
	
	* Not building using Gradle? You can grab a .jar version [in this repository](https://github.com/iainconnor/AnnoTRAITion/tree/master/maven/com/iainconnor/annotraition).
	
2. Add the annotation processor to Gradle.
	* Add the excellent [Gradle APT Plugin](https://github.com/Jimdo/gradle-apt-plugin) to your `build.gradle` file;
	
			buildscript {
				dependencies {
					repositories {
						maven {
							mavenCentral()
							url "https://oss.sonatype.org/content/repositories/snapshots/"
						}
					}

					classpath 'com.jimdo.gradle:gradle-apt-plugin:0.2-SNAPSHOT'
				}
			}
	
	* And apply the plugin;
	
			apply plugin: 'apt'
	
	* And require the processor to run;
		
			apt 'com.iainconnor:annotraition:1.0.0'
			
	* Not using Gradle? You can skip this step.

3. Add the annotation processor to your IDE.
	* If you're using IntelliJ or AndroidStudio, open *Preferences* and select *Compiler > Annotation Processors*.
	
		Check off *Enable annotation processing*.
		
		Add `com.iainconnor.annotraition.processor.Processor` under *Processor FQ Name*.
	
		![IntellJ Preferences](http://i.imgur.com/zckNWEA.png "Preferences")
		
	* Stuck on Eclipse or some other IDE? You'll need to find out how to add these flags to the javac compilation;
		
			-proc:only -processor com.iainconnor.annotraition.processor.Processor

## Usage
---

1. Create your Trait.

	Returning to the example from above, the `Tweetable` and `Facebookable` Classes are ready to use as Traits. No special coding or configuration needs to be done.
	
2. Have your Classes `Use` the Trait through annotations.

	Adding one Trait can be done by providing the Class to the `@Use` annotation;
	
		@Use (Facebookable.class)
		public class Apple {
			...
		}
	
	Multiple Traits can be added by providing the `@Uses` annotation with an array of `@Use` annotations;
		
		@Uses ({@Use (Tweetable.class), @Use (Facebookable.class)})
		public class Orange {
			...
		}

3. Use the annotated version of the Class.

	After the annotation processor has run, two new classes will be built with the names `_AppleTraited` and `_OrangeTraited`.
	
	Within your code, you should reference these Classes.

### FAQs
---

1. Whats really going on here?

	Good question. I find the easiest way to understand what's at work is to look at the output of our example above. This is the contents of `_OrangeTraited.java` after being annotated;
	
		// Generated by AnnoTRAITion.
    	// Do not edit, your changes will be overridden.
		public class _OrangeTraited extends Orange {
    		protected Facebookable facebookable;

    		/**
    		 * Passes through to `Facebookable.postToFacebook`.
    		 */
    		public void postToFacebook() {
    			this.facebookable.postToFacebook();
    		}

    		protected Tweetable tweetable;

    		/**
    		 * Passes through to `Tweetable.postToTwitter`.
    		 */
    		public void postToTwitter() {
    			tweetable.postToTwitter();
    		}
  	  	}
  	  	
  	  As you can see, local instances of the Traits have been added to this subclass, and any methods in those Traits are wrapped by proxy methods.
  	  
  	  Still not convinced? Here's another example.
  	  
  	  Given a Trait;

		public class Ipsum {
			public String foo ( String bar ) {

				return "foo" + bar;
			}
		}

	And another Trait;

		public class Sit {
			public void bar() {
				System.out.println ( "bar" );
			}
		}

	And a Class that `@Uses` both of them;

		@Uses ({@Use (Ipsum.class), @Use (Sit.class)})
		public class Lorem {
		}

	The following is the result after the annotation has run;

		// Generated by AnnoTRAITion.
    	// Do not edit, your changes will be overridden.
		public class _LoremTraited extends Lorem {
        	protected Ipsum ipsum;

        	/**
         	* Passes through to `Ipsum.foo`.
         	*/
        	public String foo ( String aString ) {
            	return this.ipsum.foo(aString);
        	}

        	protected Sit sit;

        	/**
         	* Passes through to `Sit.bar`.
         	*/
        	public void bar() {
            	sit.bar();
        	}
    	}

2. I heard that annotations slow down your code execution!

	Many annotations use run-time reflection, which can slow down your application, which is why AnnoTRAITions runs exclusively at compile time. No additional code except the example you see above is added to your run-time processing.

## Contact
---

Love it? Hate it? Want to make changes to it? Contact me at [@iainconnor](http://www.twitter.com/iainconnor) or [iainconnor@gmail.com](mailto:iainconnor@gmail.com).